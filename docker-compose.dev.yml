# Development overrides - use with: docker compose -f docker-compose.yml -f docker-compose.dev.yml up
services:
  argus:
    build:
      context: .
      dockerfile: Dockerfile
    volumes:
      - ./packages/agent/src:/app/src
      - /var/log:/host/var/log:ro
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - argus_data:/data
    environment:
      - ARGUS_DEBUG=true
    pid: "host"
    privileged: true
    command: ["python", "-m", "uvicorn", "argus_agent.main:app",
              "--host", "0.0.0.0", "--port", "7600", "--reload", "--reload-dir", "src"]
    ports:
      - "7600:7600"

  web:
    image: node:22-alpine
    working_dir: /app
    command: sh -c "npm install && npm run dev"
    ports:
      - "3000:3000"
    volumes:
      - ./packages/web:/app
      - web_node_modules:/app/node_modules
    environment:
      - NEXT_PUBLIC_AGENT_WS_URL=ws://localhost:7600/api/v1/ws
      - NEXT_PUBLIC_AGENT_API_URL=http://localhost:7600/api/v1

  cli:
    image: python:3.12-slim
    working_dir: /app
    command: ["sh", "-c", "pip install -e . && argus chat"]
    profiles: ["cli"]
    volumes:
      - ./packages/cli:/app
    environment:
      - ARGUS_URL=http://argus:7600
    depends_on:
      - argus
    stdin_open: true
    tty: true

volumes:
  argus_data:
  web_node_modules:
